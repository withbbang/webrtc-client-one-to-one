(this["webpackJsonpweb-rtc-client"]=this["webpackJsonpweb-rtc-client"]||[]).push([[0],{30:function(e,r,n){},38:function(e,r,n){"use strict";n.r(r);var t=n(11),c=n.n(t),o=n(21),a=n.n(o),u=(n(30),n(13)),s=n.n(u),i=n(18),f=n(25),l=n(14),d={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},p=function(){var e=Object(t.useRef)(),r=Object(t.useRef)(),n=Object(t.useRef)(null),c=Object(t.useRef)(null),o=function(){var t=Object(i.a)(s.a.mark((function t(){var o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:if(o=t.sent,n.current&&(n.current.srcObject=o),r.current&&e.current){t.next=7;break}return t.abrupt("return");case 7:o.getTracks().forEach((function(e){r.current&&r.current.addTrack(e,o)})),r.current.onicecandidate=function(r){if(r.candidate){if(!e.current)return;console.log("onicecandidate"),e.current.emit("candidate",r.candidate)}},r.current.oniceconnectionstatechange=function(e){console.log(e)},r.current.ontrack=function(e){console.log("add remotetrack success"),c.current&&(c.current.srcObject=e.streams[0])},e.current.emit("join_room",{room:"1234"}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),console.error(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),a=function(){var n=Object(i.a)(s.a.mark((function n(){var t;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("create offer"),r.current&&e.current){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,r.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 6:return t=n.sent,n.next=9,r.current.setLocalDescription(new RTCSessionDescription(t));case 9:e.current.emit("offer",t),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(3),console.error(n.t0);case 15:case"end":return n.stop()}}),n,null,[[3,12]])})));return function(){return n.apply(this,arguments)}}(),u=function(){var n=Object(i.a)(s.a.mark((function n(t){var c;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.current&&e.current){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,r.current.setRemoteDescription(new RTCSessionDescription(t));case 5:return console.log("answer set remote description success"),n.next=8,r.current.createAnswer({offerToReceiveVideo:!0,offerToReceiveAudio:!0});case 8:return c=n.sent,console.log("create answer"),n.next=12,r.current.setLocalDescription(new RTCSessionDescription(c));case 12:e.current.emit("answer",c),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(2),console.error(n.t0);case 18:case"end":return n.stop()}}),n,null,[[2,15]])})));return function(e){return n.apply(this,arguments)}}();return Object(t.useEffect)((function(){return e.current=f.a.connect("https://webrtc-server-one-to-one.herokuapp.com/"),r.current=new RTCPeerConnection(d),e.current.on("all_users",(function(e){e.length>0&&a()})),e.current.on("getOffer",(function(e){console.log("get offer"),u(e)})),e.current.on("getAnswer",(function(e){console.log("get answer"),r.current&&r.current.setRemoteDescription(new RTCSessionDescription(e))})),e.current.on("getCandidate",function(){var e=Object(i.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.current.addIceCandidate(new RTCIceCandidate(n));case 4:console.log("candidate add success");case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),o(),function(){e.current&&e.current.disconnect(),r.current&&r.current.close()}}),[]),Object(l.jsxs)("div",{children:[Object(l.jsx)("video",{style:{width:240,height:240,margin:5,backgroundColor:"black"},muted:!0,ref:n,autoPlay:!0}),Object(l.jsx)("video",{id:"remotevideo",style:{width:240,height:240,margin:5,backgroundColor:"black"},ref:c,autoPlay:!0})]})};a.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)(p,{})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.ec6d0e34.chunk.js.map